<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:fragment="site-head">
    <meta charset="UTF-8"/>
    <link rel="stylesheet" href="../public/css/styles.css" th:href="@{/css/styles.css}"/>
    <link rel="icon" href="../public/img/blog_icon.ico" th:href="@{/img/blog_icon.ico}"/>
    <script src="../public/js/jquery-3.1.1.min.js" th:src="@{/js/jquery-3.1.1.min.js}"></script>
    <script src="../public/js/blog-scripts.js" th:src="@{/js/blog-scripts.js}"></script>
    <meta th:include="this :: head" th:remove="tag"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
</head>
<body>
<header th:fragment="site-header">
    <a href="index.html" th:href="@{/welcome}"><img src="../public/img/blog_logo.jpg"
                                                    th:src="@{/img/blog_logo.jpg}"/></a>
    <a href="index.html" th:href="@{/welcome}">Home</a>
    <a href="posts/index.html" th:href="@{/posts/myposts}">My Posts</a>
    <a href="posts/create.html" th:href="@{/posts/create}">Create Post</a>
    <a href="users/profile.html" th:href="@{/users/profile}">Profile</a>

    <div id="logged-in-info"><span>Hello, <b th:text="${session.UserName}"
                                             th:unless="${session == null}">Guest</b></span>
        <form method="post" th:action="@{/users/logout}">
            <input type="submit" value="Logout"/>
        </form>
    </div>
</header>
<h1>Welcome</h1>
<p>Welcome to Blog Plus.</p>

<!--id is dynamically constructed and this helps jquery to load the content corresponding to a specific tag only-->
<!--every post displayed in application follows this standard-->
<div th:id="'post_' + ${post.id}" th:fragment="post">
    <article>
        <a href="#" th:href="@{/posts/view/{id}/(id=${post.id})}"><h2 id="title" class="title" th:text="${post.title}">
            Post Title</h2></a>
        <div id="posted_info" class="date">
            <i>Created on</i>
            <span th:text="${#dates.format(post.date, 'dd-MMM-yyyy')}">22-May-2016</span>
            <span th:if="${post.author}" th:remove="tag">
                <i>by</i>
                <a href="#" th:href="@{/users/profile/{username}/(username=${post.author})}" th:text="${post.author}">Test Author</a>
            </span>
        </div>
        <div id="content" class="content" th:utext="${post.body}">Test Blog Post content</div>
        <p>
            <b>Tags: </b><span id="tags" th:text="${post.tagsAsStr}"></span>

            <span class="awesome_icon" th:if="${session.SessionId != null and post.author == session.UserName}">
                &nbsp;&nbsp;<i class="fa fa-pencil-square-o" aria-hidden="true"
                               th:onclick="'preparePostEditForm(\''+ ${post.id.toString()} + '\')'"></i>
            </span>
        </p>
        <div class="awesome_icon" th:if="${session.SessionId != null}">
            <th:block th:if="${post.author != session.UserName}">
                <i class="fa fa-thumbs-up" aria-hidden="true"
                   th:onclick="'upVotePost(\''+ ${post.id.toString()} + '\')'" th:text="${post.likes}"></i>&nbsp;
                <i class="fa fa-thumbs-down" aria-hidden="true"
                   th:onclick="'downVotePost(\''+ ${post.id.toString()} + '\')'" th:text="${post.dislikes}"></i>
            </th:block>
            <th:block th:if="${post.author == session.UserName}">
                <i class="fa fa-thumbs-up" aria-hidden="true" th:text="${post.likes}"></i>&nbsp;
                <i class="fa fa-thumbs-down" aria-hidden="true" th:text="${post.dislikes}"></i>
            </th:block>
        </div>
        <br/>

        <div id="comments">

            <table border="1" class="fixed" cellpadding="8" style="background: #eee">
                <col width="600px"/>
                <tr>
                    <td><b th:text="${post.comments.size()} + ' Comments'">Comments</b></td>
                </tr>
                <tr th:if="${session.SessionId != null}">
                    <td>
                        <div class="new_comment_form">

                            <b>Post a Comment</b><br/>
                            <textarea id="comment_body" name="comment_body" cols="100" rows="5"/>
                            <button th:text="Submit" th:onclick="'addComment(\''+ ${post.id.toString()} + '\')'"
                                    style="float: right;"/>

                        </div>
                    </td>
                </tr>

                <tr th:each="c : ${post.comments}">
                    <td>
                        <a href="#" th:href="@{/users/profile/{username}/(username=${c.author})}" th:text="${c.author}">Commented
                            By</a>
                        <span th:text="' on ' + ${#dates.format(c.date, 'EEE, dd MMM yy')}"/>
                        <br/><span class="content" th:utext="${c.body}">Comment</span>
                    </td>
                </tr>
            </table>

            <p th:if="${session.SessionId == null}">
                <i>You must be <a href="users/login.html" th:href="@{/users/login}">logged in</a> to post a comment.</i>
            </p>
        </div>
    </article>
</div>


<div th:id="'post_' + ${editPostForm.id}" th:fragment="editPost">
    <article>

        <p>Required fields are followed by <strong><abbr title="required">*</abbr></strong>.</p>


        <h2>Title</h2>
        <input type="text" id="title" name="title" size="120" th:value="${editPostForm.title}"/>
        <strong><abbr title="required">*</abbr></strong>
        <br/>

        <h2>Blog Entry</h2>
        <textarea name="body" id="content" cols="120" rows="20" th:text="${editPostForm.body}"/>
        <strong><abbr title="required">*</abbr></strong>
        <br/>

        <h2>Tags</h2>
        Separate tags with a comma(,)<br/>
        <input type="text" name="tags" id="tags" size="120" th:value="${editPostForm.tags}"/>

        <p>
            <button th:text="'Save'" th:onclick="'savePost(\''+ ${editPostForm.id.toString()} + '\')'"/>
        </p>

    </article>
</div>

<footer th:fragment="site-footer">
    What is Blog Plus?
</footer>
</body>
</html>